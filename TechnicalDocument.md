# –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–∫—É–º–µ–Ω—Ç: –°–∏—Å—Ç–µ–º–∞ –ø–æ—Å—Ç–æ–≤ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞](#–æ–±–∑–æ—Ä-–ø—Ä–æ–µ–∫—Ç–∞)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
3. [–î–∏–∞–≥—Ä–∞–º–º–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤](#–¥–∏–∞–≥—Ä–∞–º–º–∞-–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤)
4. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
5. [API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã](#api-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã)
6. [–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö](#–±–∞–∑–∞-–¥–∞–Ω–Ω—ã—Ö)
7. [–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫](#–æ–±—Ä–∞–±–æ—Ç–∫–∞-–æ—à–∏–±–æ–∫)
8. [Rate Limiting](#rate-limiting)
9. [–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏](#–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å-–∏-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏)
10. [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
11. [–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ](#—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ)
12. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

---

## üéØ –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

### –¶–µ–ª—å
–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –±—ç–∫–µ–Ω–¥-—Å–∏—Å—Ç–µ–º—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ—Å—Ç–∞–º–∏ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º GraphQL API, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–µ–π –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∏ real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.

### –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∏ —á—Ç–µ–Ω–∏–µ –ø–æ—Å—Ç–æ–≤
- ‚úÖ –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (–≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç—å)
- ‚úÖ Real-time –ø–æ–¥–ø–∏—Å–∫–∏ —á–µ—Ä–µ–∑ WebSocket
- ‚úÖ –ü–∞–≥–∏–Ω–∞—Ü–∏—è –¥–ª—è –ø–æ—Å—Ç–æ–≤ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö
- ‚úÖ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–∫–ª—é—á–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –¥–ª—è –ø–æ—Å—Ç–∞
- ‚úÖ GraphQL Playground –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- ‚úÖ Health check —ç–Ω–¥–ø–æ–∏–Ω—Ç —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ë–î
- ‚úÖ Clean Architecture —Å —á–µ—Ç–∫–∏–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º —Å–ª–æ–µ–≤
- ‚úÖ **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** —Å —Ç–∏–ø–∏–∑–∞—Ü–∏–µ–π
- ‚úÖ **Rate Limiting** —Å token bucket –∞–ª–≥–æ—Ä–∏—Ç–º–æ–º
- ‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–µ SQL –∏–Ω–¥–µ–∫—Å—ã** –ø—Ä–æ—Ç–∏–≤ N+1 –ø—Ä–æ–±–ª–µ–º
- ‚úÖ **GraphQL —Å gqlgen** –¥–ª—è type-safe API
- ‚úÖ **Graceful shutdown** —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- ‚úÖ **In-Memory –∏ PostgreSQL** —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
- ‚úÖ **Docker –∏ Docker Compose** –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫
| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –í–µ—Ä—Å–∏—è |
|-----------|------------|--------|
| **–Ø–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è** | Go | 1.23+ |
| **Web Framework** | Chi Router | v5 |
| **API** | GraphQL (gqlgen) | v0.17.76 |
| **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** | PostgreSQL | 15 |
| **–î—Ä–∞–π–≤–µ—Ä –ë–î** | pgx/v5 | v5.5.5 |
| **WebSockets** | gorilla/websocket | v1.5.1 |
| **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è** | Docker + Docker Compose | - |
| **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** | Clean Architecture | - |
| **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** | GraphQL Playground | - |

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### Clean Architecture

–ü—Ä–æ–µ–∫—Ç —Å–ª–µ–¥—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø–∞–º —á–∏—Å—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Å —á–µ—Ç–∫–∏–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º —Å–ª–æ–µ–≤ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä–æ–≤ –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ –º–µ–∂–¥—É —Å–ª–æ—è–º–∏:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    API Layer (HTTP/WebSocket)               ‚îÇ
‚îÇ                          ‚Üï converters                       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                  Service Layer (Business Logic)             ‚îÇ
‚îÇ                          ‚Üï interfaces                       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                Repository Layer (Data Access)               ‚îÇ
‚îÇ                          ‚Üï converters                       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                    Domain Layer (Models)                    ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîÑ –î–∏–∞–≥—Ä–∞–º–º–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ     Client      ‚îÇ    ‚îÇ  GraphQL        ‚îÇ    ‚îÇ   WebSocket     ‚îÇ
‚îÇ   (Browser)     ‚îÇ    ‚îÇ  Playground     ‚îÇ    ‚îÇ   Client        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
          ‚îÇ HTTP POST            ‚îÇ HTTP GET              ‚îÇ WS
          ‚îÇ /graphql             ‚îÇ /                     ‚îÇ /subscriptions
          ‚îÇ                      ‚îÇ                       ‚îÇ
          ‚ñº                      ‚ñº                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      Chi Router (API Layer)                     ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ ‚îÇ CORS Middleware ‚îÇ ‚îÇ Rate Limiter    ‚îÇ ‚îÇ   Error Handler     ‚îÇ ‚îÇ
‚îÇ ‚îÇ                 ‚îÇ ‚îÇ (Token Bucket)  ‚îÇ ‚îÇ  (Typed Errors)     ‚îÇ ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ
                          ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   gqlgen Handler                                ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ ‚îÇ   GraphQL       ‚îÇ ‚îÇ   Schema        ‚îÇ ‚îÇ    WebSocket        ‚îÇ ‚îÇ
‚îÇ ‚îÇ  Server         ‚îÇ ‚îÇ  Validator      ‚îÇ ‚îÇ   Transport         ‚îÇ ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ
                          ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Service Layer                               ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ ‚îÇ   Resolvers     ‚îÇ ‚îÇ  Business       ‚îÇ ‚îÇ    Pub/Sub          ‚îÇ ‚îÇ
‚îÇ ‚îÇ (Query/Mutation)‚îÇ ‚îÇ   Logic         ‚îÇ ‚îÇ   System            ‚îÇ ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ Storage Interface
                          ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  Repository Layer                              ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ ‚îÇ  PostgreSQL     ‚îÇ ‚îÇ   In-Memory     ‚îÇ ‚îÇ    Converters       ‚îÇ ‚îÇ
‚îÇ ‚îÇ  Storage        ‚îÇ ‚îÇ   Storage       ‚îÇ ‚îÇ  (Domain ‚Üî DB)      ‚îÇ ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
            ‚îÇ
            ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      Database Layer                            ‚îÇ
‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ ‚îÇ   PostgreSQL    ‚îÇ ‚îÇ    Connection   ‚îÇ ‚îÇ   Optimized         ‚îÇ ‚îÇ
‚îÇ ‚îÇ   Database      ‚îÇ ‚îÇ     Pool        ‚îÇ ‚îÇ   Indexes           ‚îÇ ‚îÇ
‚îÇ ‚îÇ                 ‚îÇ ‚îÇ    (pgxpool)    ‚îÇ ‚îÇ   (Performance)     ‚îÇ ‚îÇ
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                        Data Flow                               ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ 1. Client ‚Üí HTTP Request ‚Üí Rate Limiter ‚Üí CORS ‚Üí Router        ‚îÇ
‚îÇ 2. Router ‚Üí gqlgen Handler ‚Üí Schema Validation                 ‚îÇ
‚îÇ 3. Handler ‚Üí Resolver ‚Üí Business Logic ‚Üí Storage Interface     ‚îÇ
‚îÇ 4. Storage ‚Üí Converter ‚Üí Database Query ‚Üí Result               ‚îÇ
‚îÇ 5. Result ‚Üí Converter ‚Üí Domain Model ‚Üí GraphQL Response        ‚îÇ
‚îÇ 6. Response ‚Üí Client                                            ‚îÇ
‚îÇ                                                                 ‚îÇ
‚îÇ Real-time: Client ‚Üî WebSocket ‚Üî Pub/Sub ‚Üî GraphQL Subscription ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –°–ª–æ–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

#### 1. **Domain Layer** (`internal/model/`)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ß–∏—Å—Ç—ã–µ –±–∏–∑–Ω–µ—Å-–º–æ–¥–µ–ª–∏ –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**:
  - `entities.go` - –î–æ–º–µ–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏ (Post, Comment, PostWithComments, CommentTree)
  - –ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –º–æ–¥–µ–ª–∏
  - –ú–µ—Ç–æ–¥—ã –¥–æ–º–µ–Ω–Ω–æ–π –ª–æ–≥–∏–∫–∏ (IsValidTitle, IsValidContent, IsValidComment)

#### 2. **Repository Layer** (`internal/repository/`)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏
- **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**:
  - `storage.go` - –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
  - `postgres.go` - PostgreSQL —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º–∏
  - `memory.go` - In-Memory —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
  - `model/storage_models.go` - –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –±–∞–∑—ã
  - `converter/converter.go` - –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä—ã –º–µ–∂–¥—É –¥–æ–º–µ–Ω–Ω—ã–º–∏ –∏ –ë–î –º–æ–¥–µ–ª—è–º–∏

#### 3. **Service Layer** (`internal/service/`)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∏ GraphQL —Ä–µ–∑–æ–ª–≤–µ—Ä—ã
- **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**:
  - `gqlgen_service.go` - GraphQL —Å—Ö–µ–º–∞ –∏ —Å–µ—Ä–≤–∏—Å —Å gqlgen
  - `schema.resolvers.go` - –†–µ–∑–æ–ª–≤–µ—Ä—ã –¥–ª—è Query, Mutation, Subscription
  - `generated/` - –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ –æ—Ç gqlgen
  - –í–∞–ª–∏–¥–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª
  - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Pub/Sub
  - Health check –ª–æ–≥–∏–∫–∞

#### 4. **API Layer** (`internal/api/`)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û–±—Ä–∞–±–æ—Ç–∫–∞ HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤ –∏ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**:
  - `gqlgen_handler.go` - GraphQL HTTP —Ö–µ–Ω–¥–ª–µ—Ä –∏ WebSocket —Å gqlgen
  - `errors.go` - **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫**
  - `rate_limiter.go` - **Multi-level rate limiting —Å–∏—Å—Ç–µ–º–∞**
  - CORS middleware
  - GraphQL Playground
  - Health check endpoint

#### 5. **Configuration Layer** (`internal/config/`)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**:
  - `config.go` - –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ environment variables
  - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è timeout'–æ–≤, limits, CORS

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
CommentsSystem/
‚îú‚îÄ‚îÄ üìÅ cmd/                          # –¢–æ—á–∫–∏ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ app/
‚îÇ       ‚îî‚îÄ‚îÄ üìÑ main.go               # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Å graceful shutdown
‚îÇ
‚îú‚îÄ‚îÄ üìÅ internal/                     # –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –ª–æ–≥–∏–∫–∞ (–Ω–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è)
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ api/                      # HTTP –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ gqlgen_handler.go     # GraphQL –∏ WebSocket —Ö–µ–Ω–¥–ª–µ—Ä—ã —Å gqlgen
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ errors.go             # ‚≠ê –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ rate_limiter.go       # ‚≠ê Multi-level rate limiting —Å–∏—Å—Ç–µ–º–∞
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ config/                   # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ config.go             # –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ model/                    # –î–æ–º–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ (Domain Layer)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ entities.go           # –ß–∏—Å—Ç—ã–µ –¥–æ–º–µ–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ üìÅ repository/               # –°–ª–æ–π –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ storage.go            # –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ postgres.go           # PostgreSQL —Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ memory.go             # ‚≠ê In-Memory —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è development
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ postgres_test.go      # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ model/                # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ë–î
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ storage_models.go # PostDB, CommentDB —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÅ converter/            # –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä—ã Domain ‚Üî Storage
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ üìÑ converter.go      # PostConverter, CommentConverter, TreeConverter
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ service/                  # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ       ‚îú‚îÄ‚îÄ üìÑ gqlgen_service.go     # ‚≠ê GraphQL —Å–µ—Ä–≤–∏—Å —Å gqlgen
‚îÇ       ‚îú‚îÄ‚îÄ üìÑ resolver.go           # Base resolver
‚îÇ       ‚îú‚îÄ‚îÄ üìÑ schema.resolvers.go   # ‚≠ê –¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∑–æ–ª–≤–µ—Ä—ã —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
‚îÇ       ‚îú‚îÄ‚îÄ üìÑ schema.graphqls       # ‚≠ê GraphQL —Å—Ö–µ–º–∞
‚îÇ       ‚îú‚îÄ‚îÄ üìÑ service_test.go       # Unit —Ç–µ—Å—Ç—ã
‚îÇ       ‚îî‚îÄ‚îÄ üìÅ generated/            # ‚≠ê –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ gqlgen
‚îÇ           ‚îú‚îÄ‚îÄ üìÑ exec.go
‚îÇ           ‚îî‚îÄ‚îÄ üìÑ models.go
‚îÇ
‚îú‚îÄ‚îÄ üìÅ pkg/                          # –ü—É–±–ª–∏—á–Ω—ã–µ –ø–∞–∫–µ—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ pubsub/                   # Pub/Sub —Å–∏—Å—Ç–µ–º–∞
‚îÇ       ‚îî‚îÄ‚îÄ üìÑ pubsub.go             # –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
‚îÇ
‚îú‚îÄ‚îÄ üìÅ migrations/                   # –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îî‚îÄ‚îÄ üìÑ 001_init_schema.sql      # ‚≠ê –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ö–µ–º–∞ —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏
‚îÇ
‚îú‚îÄ‚îÄ üìÅ scripts/                      # ‚≠ê –°–∫—Ä–∏–ø—Ç—ã –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚îú‚îÄ‚îÄ üìÅ coverage/                     # ‚≠ê –û—Ç—á–µ—Ç—ã –ø–æ–∫—Ä—ã—Ç–∏—è —Ç–µ—Å—Ç–∞–º–∏
‚îÇ
‚îú‚îÄ‚îÄ üìÑ go.mod                        # Go –º–æ–¥—É–ª—å —Å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
‚îú‚îÄ‚îÄ üìÑ go.sum                        # –•–µ—à–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
‚îú‚îÄ‚îÄ üìÑ gqlgen.yml                   # ‚≠ê –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è gqlgen
‚îú‚îÄ‚îÄ üìÑ Dockerfile                    # –ú–Ω–æ–≥–æ—Å—Ç–∞–¥–∏–π–Ω–∞—è —Å–±–æ—Ä–∫–∞ (Go 1.23)
‚îú‚îÄ‚îÄ üìÑ docker-compose.yml           # –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
‚îú‚îÄ‚îÄ üìÑ Makefile                     # ‚≠ê –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚îú‚îÄ‚îÄ üìÑ .gitignore                   # –ò—Å–∫–ª—é—á–µ–Ω–∏—è Git
‚îú‚îÄ‚îÄ üìÑ README.md                    # ‚≠ê Comprehensive –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ üìÑ CLEAN_ARCHITECTURE.md        # –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
‚îî‚îÄ‚îÄ üìÑ TechnicalDocument.md         # –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–∫—É–º–µ–Ω—Ç (—ç—Ç–æ—Ç —Ñ–∞–π–ª)
```

### –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤

#### **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Å–ª–æ–∏**

| –°–ª–æ–π | –§–∞–π–ª—ã | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|-------|------------|
| **Domain Layer** | `internal/model/entities.go` | –ß–∏—Å—Ç—ã–µ –±–∏–∑–Ω–µ—Å-–º–æ–¥–µ–ª–∏ –±–µ–∑ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π |
| **Repository Layer** | `internal/repository/*.go` | –î–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º —Å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –º–æ–¥–µ–ª—è–º–∏ |
| **Service Layer** | `internal/service/*.go` | –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∏ GraphQL —Ä–µ–∑–æ–ª–≤–µ—Ä—ã |
| **API Layer** | `internal/api/*.go` | HTTP –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏ –≤–Ω–µ—à–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã |
| **Configuration Layer** | `internal/config/*.go` | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π |

#### **–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-----------|------|------------|
| **–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞** | `cmd/app/main.go` | –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤, graceful shutdown |
| **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** | `internal/config/config.go` | –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π |
| **–î–æ–º–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏** | `internal/model/entities.go` | Post, Comment, PostWithComments, CommentTree |
| **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** | `internal/api/errors.go` | –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫ |
| **Rate Limiting** | `internal/api/rate_limiter.go` | Multi-level –∑–∞—â–∏—Ç–∞ –æ—Ç –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–π |
| **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —Ö—Ä–∞–Ω–∏–ª–∏—â–∞** | `internal/repository/storage.go` | Storage —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º–∏ –º–µ—Ç–æ–¥–∞–º–∏ |
| **PostgreSQL —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è** | `internal/repository/postgres.go` | –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã |
| **In-Memory —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è** | `internal/repository/memory.go` | Thread-safe —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ |
| **–ú–æ–¥–µ–ª–∏ –ë–î** | `internal/repository/model/storage_models.go` | PostDB, CommentDB —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π |
| **–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä—ã –ë–î** | `internal/repository/converter/converter.go` | Domain ‚Üî Storage –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è |
| **GraphQL —Å–µ—Ä–≤–∏—Å** | `internal/service/gqlgen_service.go` | Type-safe GraphQL —Å gqlgen |
| **–†–µ–∑–æ–ª–≤–µ—Ä—ã** | `internal/service/schema.resolvers.go` | –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∑–æ–ª–≤–µ—Ä—ã |
| **HTTP —Ö–µ–Ω–¥–ª–µ—Ä—ã** | `internal/api/gqlgen_handler.go` | –û–±—Ä–∞–±–æ—Ç–∫–∞ GraphQL –∏ WebSocket |
| **Pub/Sub** | `pkg/pubsub/pubsub.go` | Thread-safe —Å–∏—Å—Ç–µ–º–∞ –ø–æ–¥–ø–∏—Å–æ–∫ |

---

## üîå API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### HTTP —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|------|------------|----------|
| `GET` | `/` | GraphQL Playground | –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è GraphQL |
| `POST` | `/graphql` | GraphQL API | –û—Å–Ω–æ–≤–Ω–æ–π —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è GraphQL –∑–∞–ø—Ä–æ—Å–æ–≤ |
| `WebSocket` | `/subscriptions` | WebSocket | –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è real-time –ø–æ–¥–ø–∏—Å–æ–∫ |
| `GET` | `/health` | Health Check | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞ –∏ –ë–î |

### GraphQL API

#### **Query (–ó–∞–ø—Ä–æ—Å—ã)**

##### `posts(limit: Int, offset: Int): [Post!]!`
–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–æ—Å—Ç–æ–≤ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `limit` (Int, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 10, –º–∞–∫—Å: 100) - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Å—Ç–æ–≤
- `offset` (Int, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 0) - —Å–º–µ—â–µ–Ω–∏–µ

**–í–∞–ª–∏–¥–∞—Ü–∏—è:**
- `limit`: –æ—Ç 1 –¥–æ 100
- `offset`: –Ω–µ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–π

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```graphql
query {
  posts(limit: 5, offset: 0) {
    id
    title
    content
    commentsEnabled
    createdAt
    comments(limit: 10, offset: 0) {
      id
      content
      parentId
      createdAt
    }
  }
}
```

##### `post(id: ID!): Post`
–ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ—Å—Ç–∞ –ø–æ ID.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `id` (ID!) - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ—Å—Ç–∞ (UUID)

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```graphql
query {
  post(id: "35d67a04-2829-4380-8f82-bcfdf8e5ca16") {
    id
    title
    content
    commentsEnabled
    createdAt
    comments(limit: 20, offset: 0) {
      id
      content
      parentId
      createdAt
      children(limit: 5, offset: 0) {
        id
        content
        createdAt
      }
    }
  }
}
```

#### **Mutation (–ú—É—Ç–∞—Ü–∏–∏)**

##### `createPost(title: String!, content: String!): Post!`
–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø–æ—Å—Ç–∞.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `title` (String!) - –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ—Å—Ç–∞
- `content` (String!) - —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–æ—Å—Ç–∞

**–í–∞–ª–∏–¥–∞—Ü–∏—è:**
- –ó–∞–≥–æ–ª–æ–≤–æ–∫: –æ—Ç 1 –¥–æ 255 —Å–∏–º–≤–æ–ª–æ–≤
- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ: –æ—Ç 1 –¥–æ 10000 —Å–∏–º–≤–æ–ª–æ–≤

**Rate Limiting:**
- 10 –ø–æ—Å—Ç–æ–≤ –≤ –º–∏–Ω—É—Ç—É –Ω–∞ IP
- 100 –ø–æ—Å—Ç–æ–≤ –≤ —á–∞—Å –Ω–∞ IP

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```graphql
mutation {
  createPost(
    title: "–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Go –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π"
    content: "–ü–æ–¥—Ä–æ–±–Ω—ã–π —Ä–∞–∑–±–æ—Ä Clean Architecture, GraphQL –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏..."
  ) {
    id
    title
    content
    commentsEnabled
    createdAt
  }
}
```

##### `createComment(postId: ID!, parentId: ID, content: String!): Comment!`
–°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –∫ –ø–æ—Å—Ç—É.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `postId` (ID!) - ID –ø–æ—Å—Ç–∞
- `parentId` (ID, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) - ID —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
- `content` (String!) - —Ç–µ–∫—Å—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è (–º–∞–∫—Å. 2000 —Å–∏–º–≤–æ–ª–æ–≤)

**–í–∞–ª–∏–¥–∞—Ü–∏—è:**
- –î–ª–∏–Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è: –æ—Ç 1 –¥–æ 2000 —Å–∏–º–≤–æ–ª–æ–≤
- –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω—ã –¥–ª—è –ø–æ—Å—Ç–∞
- –ü–æ—Å—Ç –¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å
- –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω `parentId`, —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å

**Rate Limiting:**
- 5 –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∫ –æ–¥–Ω–æ–º—É –ø–æ—Å—Ç—É –∑–∞ 10 –º–∏–Ω—É—Ç
- 20 –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –≤ –º–∏–Ω—É—Ç—É –Ω–∞ IP (–æ–±—â–∏–π –ª–∏–º–∏—Ç)

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```graphql
mutation {
  createComment(
    postId: "35d67a04-2829-4380-8f82-bcfdf8e5ca16"
    content: "–û—Ç–ª–∏—á–Ω–∞—è —Å—Ç–∞—Ç—å—è! –û—Å–æ–±–µ–Ω–Ω–æ –ø–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å –ø—Ä–æ —Ä–µ—à–µ–Ω–∏–µ N+1 –ø—Ä–æ–±–ª–µ–º—ã."
  ) {
    id
    content
    parentId
    createdAt
  }
}
```

##### `toggleComments(postId: ID!, enable: Boolean!): Post!`
–í–∫–ª—é—á–µ–Ω–∏–µ/–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –¥–ª—è –ø–æ—Å—Ç–∞.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `postId` (ID!) - ID –ø–æ—Å—Ç–∞
- `enable` (Boolean!) - true –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è, false –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:**
```graphql
mutation {
  toggleComments(
    postId: "35d67a04-2829-4380-8f82-bcfdf8e5ca16"
    enable: false
  ) {
    id
    title
    commentsEnabled
  }
}
```

#### **Subscription (–ü–æ–¥–ø–∏—Å–∫–∏)**

##### `commentAdded(postId: ID!): Comment!`
–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –Ω–æ–≤—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –ø–æ—Å—Ç—É.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `postId` (ID!) - ID –ø–æ—Å—Ç–∞ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- Real-time —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ WebSocket
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- Graceful handling –æ—Ç–∫–ª—é—á–µ–Ω–∏–π

**–ü—Ä–∏–º–µ—Ä –ø–æ–¥–ø–∏—Å–∫–∏:**
```graphql
subscription {
  commentAdded(postId: "35d67a04-2829-4380-8f82-bcfdf8e5ca16") {
    id
    content
    parentId
    createdAt
  }
}
```

### WebSocket –ø—Ä–æ—Ç–æ–∫–æ–ª

–î–ª—è –ø–æ–¥–ø–∏—Å–æ–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ:

1. **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ**: `ws://localhost:8080/subscriptions`
2. **–§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –ø–æ–¥–ø–∏—Å–∫–∏**:
```json
{
  "type": "subscribe",
  "query": "subscription { commentAdded(postId: \"...\") { id content createdAt } }",
  "variables": {
    "postId": "35d67a04-2829-4380-8f82-bcfdf8e5ca16"
  }
}
```

### Health Check —ç–Ω–¥–ø–æ–∏–Ω—Ç

#### **GET /health**
–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞ –∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:

**–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç:**
```json
{
  "status": "ok",
  "service": "CommentsSystem",
  "version": "1.0.0",
  "timestamp": "2024-01-15T10:30:00Z"
}
```

**–û—Ç–≤–µ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ:**
```json
{
  "status": "error",
  "error": "database connection failed",
  "timestamp": "2024-01-15T10:30:00Z"
}
```

---

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

#### –¢–∞–±–ª–∏—Ü–∞ `posts`
| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è |
|------|-----|----------|-------------|
| `id` | UUID | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á | PRIMARY KEY, DEFAULT gen_random_uuid() |
| `title` | VARCHAR(255) | –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ—Å—Ç–∞ | NOT NULL |
| `content` | TEXT | –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–æ—Å—Ç–∞ | NOT NULL |
| `comments_enabled` | BOOLEAN | –†–∞–∑—Ä–µ—à–µ–Ω—ã –ª–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ | NOT NULL, DEFAULT true |
| `created_at` | TIMESTAMPTZ | –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è | NOT NULL, DEFAULT NOW() |

#### –¢–∞–±–ª–∏—Ü–∞ `comments`
| –ü–æ–ª–µ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è |
|------|-----|----------|-------------|
| `id` | UUID | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–ª—é—á | PRIMARY KEY, DEFAULT gen_random_uuid() |
| `post_id` | UUID | –°—Å—ã–ª–∫–∞ –Ω–∞ –ø–æ—Å—Ç | FOREIGN KEY, NOT NULL |
| `parent_id` | UUID | –°—Å—ã–ª–∫–∞ –Ω–∞ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π | FOREIGN KEY, NULL –¥–ª—è –∫–æ—Ä–Ω–µ–≤—ã—Ö |
| `content` | VARCHAR(2000) | –¢–µ–∫—Å—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è | NOT NULL, –º–∞–∫—Å. 2000 —Å–∏–º–≤–æ–ª–æ–≤ |
| `created_at` | TIMESTAMPTZ | –í—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è | NOT NULL, DEFAULT NOW() |

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã

```sql
-- –ë–∞–∑–æ–≤—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø–æ–∏—Å–∫–∞
CREATE INDEX idx_comments_post_id ON comments(post_id);
CREATE INDEX idx_comments_parent_id ON comments(parent_id);

-- –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨: –°–æ—Å—Ç–∞–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
-- –ò–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –∫–æ—Ä–Ω–µ–≤—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ —Å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π
CREATE INDEX idx_comments_post_root_created ON comments(post_id, created_at)
WHERE parent_id IS NULL;

-- –ò–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –¥–æ—á–µ—Ä–Ω–∏—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ —Å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π
CREATE INDEX idx_comments_parent_created ON comments(parent_id, created_at)
WHERE parent_id IS NOT NULL;

-- –ò–Ω–¥–µ–∫—Å –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ—Å—Ç–æ–≤ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ —Å–æ–∑–¥–∞–Ω–∏—è
CREATE INDEX idx_posts_created_at ON posts(created_at DESC);

-- –ò–Ω–¥–µ–∫—Å –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ—Å—Ç–æ–≤
CREATE INDEX idx_posts_comments_enabled ON posts(comments_enabled)
WHERE comments_enabled = true;
```

### –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–µ—Ä–∞—Ä—Ö–∏–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π CTE (Common Table Expression):

```sql
WITH RECURSIVE comment_tree AS (
    -- –ë–∞–∑–æ–≤—ã–π —Å–ª—É—á–∞–π: –∫–æ—Ä–Ω–µ–≤—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
    SELECT id, post_id, parent_id, content, created_at, 0 as level
    FROM comments
    WHERE post_id = $1 AND parent_id IS NULL

    UNION ALL

    -- –†–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è —á–∞—Å—Ç—å: –¥–æ—á–µ—Ä–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
    SELECT c.id, c.post_id, c.parent_id, c.content, c.created_at, ct.level + 1
    FROM comments c
    INNER JOIN comment_tree ct ON c.parent_id = ct.id
)
SELECT id, post_id, parent_id, content, created_at, level
FROM comment_tree
ORDER BY level, created_at;
```

---

## ‚ö†Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—à–∏–±–æ–∫

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ —Å –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º–∏ –∫–æ–¥–∞–º–∏:

#### –ö–æ–¥—ã –æ—à–∏–±–æ–∫
```go
const (
    ErrCodeValidation       = "VALIDATION_ERROR"      // –û—à–∏–±–∫–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
    ErrCodeNotFound         = "NOT_FOUND"             // –°—É—â–Ω–æ—Å—Ç—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
    ErrCodeForbidden        = "FORBIDDEN"             // –î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω
    ErrCodeRateLimit        = "RATE_LIMIT_EXCEEDED"   // –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤
    ErrCodeTooLarge         = "PAYLOAD_TOO_LARGE"     // –°–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∏–µ –¥–∞–Ω–Ω—ã–µ
    ErrCodeInternal         = "INTERNAL_ERROR"        // –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞
    ErrCodeUnavailable      = "SERVICE_UNAVAILABLE"   // –°–µ—Ä–≤–∏—Å –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
    ErrCodeDuplicate        = "DUPLICATE_ENTITY"      // –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–∏
    ErrCodeInvalidInput     = "INVALID_INPUT"         // –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≤–≤–æ–¥
    ErrCodeCommentsDisabled = "COMMENTS_DISABLED"     // –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –æ—Ç–∫–ª—é—á–µ–Ω—ã
)
```

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—à–∏–±–∫–∏ API
```go
type APIError struct {
    Code    string `json:"code"`              // –ö–æ–¥ –æ—à–∏–±–∫–∏ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞
    Message string `json:"message"`           // –ß–µ–ª–æ–≤–µ–∫–æ—á–∏—Ç–∞–µ–º–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    Details string `json:"details,omitempty"` // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ—Ç–∞–ª–∏
}

type ErrorResponse struct {
    Error   APIError `json:"error"`   // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ—à–∏–±–∫–µ
    Success bool     `json:"success"` // –í—Å–µ–≥–¥–∞ false –¥–ª—è –æ—à–∏–±–æ–∫
}
```

#### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ GraphQL
```go
func (h *GraphQLErrorHandler) FormatGraphQLError(ctx context.Context, err error) error {
    // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–∫–∏
    h.logError(ctx, err)

    // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤ GraphQL –æ—à–∏–±–∫—É —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Ç–∏–ø–∞
    switch {
    case errors.Is(err, repository.ErrNotFound):
        return gqlerror.Errorf("Entity not found")
    case isValidationError(err):
        return gqlerror.Errorf("Validation failed: %s", err.Error())
    default:
        return gqlerror.Errorf("Internal error occurred")
    }
}
```

#### –ü—Ä–∏–º–µ—Ä—ã –æ—à–∏–±–æ–∫

**–í–∞–ª–∏–¥–∞—Ü–∏—è:**
```json
{
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Validation failed",
    "details": "Title must be between 1 and 255 characters"
  },
  "success": false
}
```

**–°—É—â–Ω–æ—Å—Ç—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞:**
```json
{
  "error": {
    "code": "NOT_FOUND",
    "message": "Requested resource not found",
    "details": "The entity you are looking for does not exist or has been removed"
  },
  "success": false
}
```

**Rate Limit:**
```json
{
  "error": {
    "code": "RATE_LIMIT_EXCEEDED",
    "message": "Rate limit exceeded",
    "details": "Too many requests, please try again later"
  },
  "success": false
}
```

---

## üõ°Ô∏è Rate Limiting

### Multi-level —Å–∏—Å—Ç–µ–º–∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤

#### 1. –û–±—â–∏–π HTTP Rate Limiter
**Token Bucket –∞–ª–≥–æ—Ä–∏—Ç–º** —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:

```go
type RateLimiter struct {
    visitors map[string]*Visitor // IP -> –ø–æ—Å–µ—Ç–∏—Ç–µ–ª—å
    mu       sync.RWMutex        // Thread-safe –¥–æ—Å—Ç—É–ø
    rate     time.Duration       // –ò–Ω—Ç–µ—Ä–≤–∞–ª –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–æ–≤
    capacity int                 // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–∫–µ–Ω–æ–≤
}
```

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:**
- 100 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É –Ω–∞ IP
- Burst capacity: 200 –∑–∞–ø—Ä–æ—Å–æ–≤
- –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞ –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç

#### 2. Comment Rate Limiter
**–°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤:**

```go
type CommentRateLimiter struct {
    *RateLimiter                           // –ë–∞–∑–æ–≤—ã–π rate limiter
    perPostLimits map[string]*PostLimiter  // –õ–∏–º–∏—Ç—ã –ø–æ –ø–æ—Å—Ç–∞–º
}
```

**–ü—Ä–∞–≤–∏–ª–∞:**
- 5 –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∫ –æ–¥–Ω–æ–º—É –ø–æ—Å—Ç—É –∑–∞ 10 –º–∏–Ω—É—Ç
- 20 –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –≤ –º–∏–Ω—É—Ç—É –Ω–∞ IP (–æ–±—â–∏–π –ª–∏–º–∏—Ç)
- –û—Ç–¥–µ–ª—å–Ω–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ –ø–æ—Å—Ç–∞–º

#### 3. GraphQL Rate Limiter
**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ GraphQL –∑–∞–ø—Ä–æ—Å–æ–≤:**

```go
type GraphQLRateLimiter struct {
    *RateLimiter
    complexityLimits map[string]int // –õ–∏–º–∏—Ç—ã –ø–æ —Ç–∏–ø–∞–º –æ–ø–µ—Ä–∞—Ü–∏–π
}
```

**–õ–∏–º–∏—Ç—ã —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:**
- Query: –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å 1000
- Mutation: –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å 500
- Subscription: –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å 200

#### Middleware –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

```go
// HTTP middleware
func (rl *RateLimiter) Middleware() func(http.Handler) http.Handler {
    return func(next http.Handler) http.Handler {
        return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
            ip := rl.getClientIP(r)

            if !rl.Allow(ip) {
                http.Error(w, "Rate limit exceeded", http.StatusTooManyRequests)
                return
            }

            next.ServeHTTP(w, r)
        })
    }
}
```

#### Monitoring –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

```go
func (rl *RateLimiter) GetStats() map[string]interface{} {
    return map[string]interface{}{
        "active_visitors": len(rl.visitors),
        "rate_per_second": int(time.Second / rl.rate),
        "burst_capacity":  rl.capacity,
    }
}
```

---

## üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –†–µ—à–µ–Ω–∏–µ N+1 –ø—Ä–æ–±–ª–µ–º—ã

#### 1. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ GraphQL —Ä–µ–∑–æ–ª–≤–µ—Ä—ã
**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è N+1 –ø—Ä–æ–±–ª–µ–º–∞ –≤ GraphQL –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤.

**–†–µ—à–µ–Ω–∏–µ:** –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã –≤ Storage interface:

```go
// –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–ª—å–∫–æ –∫–æ—Ä–Ω–µ–≤—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
func GetRootCommentsByPostID(ctx context.Context, postID uuid.UUID, limit, offset int) ([]model.Comment, error)

// –ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ—á–µ—Ä–Ω–∏—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
func GetCommentsByParentID(ctx context.Context, parentID uuid.UUID, limit, offset int) ([]model.Comment, error)
```

#### 2. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã
**–ö–æ—Ä–Ω–µ–≤—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:**
```sql
SELECT id, post_id, parent_id, content, created_at
FROM comments
WHERE post_id = $1 AND parent_id IS NULL
ORDER BY created_at ASC
LIMIT $2 OFFSET $3
```

**–î–æ—á–µ—Ä–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:**
```sql
SELECT id, post_id, parent_id, content, created_at
FROM comments
WHERE parent_id = $1
ORDER BY created_at ASC
LIMIT $2 OFFSET $3
```

#### 3. –°–æ—Å—Ç–∞–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
```sql
-- –ò–Ω–¥–µ–∫—Å –¥–ª—è –∫–æ—Ä–Ω–µ–≤—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ —Å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π
CREATE INDEX idx_comments_post_root_created ON comments(post_id, created_at)
WHERE parent_id IS NULL;

-- –ò–Ω–¥–µ–∫—Å –¥–ª—è –¥–æ—á–µ—Ä–Ω–∏—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ —Å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π
CREATE INDEX idx_comments_parent_created ON comments(parent_id, created_at)
WHERE parent_id IS NOT NULL;
```

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ Connection Pooling

#### PostgreSQL Connection Pool
```go
// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ pgxpool –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
config, err := pgxpool.ParseConfig(dsn)
config.MaxConns = 30        // –ú–∞–∫—Å–∏–º—É–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
config.MinConns = 5         // –ú–∏–Ω–∏–º—É–º –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
config.MaxConnLifetime = time.Hour
config.MaxConnIdleTime = time.Minute * 30
```

#### Pub/Sub –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
```go
// –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π —Ä–∞–∑–º–µ—Ä –±—É—Ñ–µ—Ä–∞ –∫–∞–Ω–∞–ª–æ–≤
pubsub := pubsub.NewWithConfig(100) // 100 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –±—É—Ñ–µ—Ä–µ

// –ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–∞—è –ø—É–±–ª–∏–∫–∞—Ü–∏—è
func (ps *PubSub) Publish(topic string, data interface{}) {
    select {
    case subscriber.Channel <- message:
        // –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ
    default:
        // –ö–∞–Ω–∞–ª –∑–∞–ø–æ–ª–Ω–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º (–Ω–µ–±–ª–æ–∫–∏—Ä—É—é—â–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è)
    }
}
```

### –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –ª–∏–º–∏—Ç—ã

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
```go
// –í–∞–ª–∏–¥–∞—Ü–∏—è –ª–∏–º–∏—Ç–æ–≤ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
func validatePaginationParams(limit, offset *int) (int, int, error) {
    l := 10 // default
    if limit != nil {
        if *limit < 1 || *limit > 100 {
            return 0, 0, fmt.Errorf("limit must be between 1 and 100")
        }
        l = *limit
    }

    o := 0 // default
    if offset != nil {
        if *offset < 0 {
            return 0, 0, fmt.Errorf("offset must be non-negative")
        }
        o = *offset
    }

    return l, o, nil
}
```

#### –õ–∏–º–∏—Ç—ã –∫–æ–Ω—Ç–µ–Ω—Ç–∞
```go
const (
    MaxTitleLength    = 255   // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞
    MaxContentLength  = 10000 // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –ø–æ—Å—Ç–∞
    MaxCommentLength  = 2000  // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
    MaxPageSize       = 100   // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    DefaultPageSize   = 10    // –†–∞–∑–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
)
```

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

#### –ú–µ—Ç—Ä–∏–∫–∏
- **Request latency**: –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ GraphQL –∑–∞–ø—Ä–æ—Å–æ–≤
- **Throughput**: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É
- **Error rate**: –ø—Ä–æ—Ü–µ–Ω—Ç –æ—à–∏–±–æ—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- **Database performance**: –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è SQL –∑–∞–ø—Ä–æ—Å–æ–≤
- **Connection pool**: –∞–∫—Ç–∏–≤–Ω—ã–µ/idle —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- **Memory usage**: –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º

#### –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
```go
// –í—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
import _ "net/http/pprof"

// Health check —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏
func (h *Handler) healthCheck(w http.ResponseWriter, r *http.Request) {
    stats := map[string]interface{}{
        "status": "ok",
        "version": "1.0.0",
        "uptime": time.Since(startTime).String(),
        "goroutines": runtime.NumGoroutine(),
        "memory": getMemStats(),
    }
    json.NewEncoder(w).Encode(stats)
}
```

---

## üîß GraphQL Schema

### –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç—Ä–æ–≥–æ —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é GraphQL —Å—Ö–µ–º—É:

#### **Post Type**
```graphql
type Post {
  id: ID!
  title: String!
  content: String!
  commentsEnabled: Boolean!
  createdAt: String!
  comments(limit: Int = 10, offset: Int = 0): [Comment!]!
}
```

#### **Comment Type**
```graphql
type Comment {
  id: ID!
  content: String!
  parentId: ID
  createdAt: String!
  children(limit: Int = 10, offset: Int = 0): [Comment!]!
}
```

#### **Operations**
- **Query**: –û–ø–µ—Ä–∞—Ü–∏–∏ —á—Ç–µ–Ω–∏—è (`posts`, `post`)
- **Mutation**: –û–ø–µ—Ä–∞—Ü–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è (`createPost`, `createComment`, `toggleComments`)
- **Subscription**: Real-time –ø–æ–¥–ø–∏—Å–∫–∏ (`commentAdded`)

### GraphQL Playground

#### **–î–æ—Å—Ç—É–ø –∫ Playground**
- **URL**: http://localhost:8080/
- **–§—É–Ω–∫—Ü–∏–∏**:
  - –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ GraphQL
  - –ê–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
  - –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ö–µ–º—ã –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
  - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–ø–∏—Å–æ–∫ —á–µ—Ä–µ–∑ WebSocket

### Health Check —ç–Ω–¥–ø–æ–∏–Ω—Ç

#### **GET /health**
–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞ –∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:

**–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç:**
```json
{
  "status": "ok",
  "service": "CommentsSystem",
  "version": "1.0.0",
  "timestamp": "2024-01-15T10:30:00Z"
}
```

**–û—Ç–≤–µ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ:**
```json
{
  "status": "error",
  "error": "database connection failed",
  "timestamp": "2024-01-15T10:30:00Z"
}
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### Health Check

–°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
curl http://localhost:8080/health

# –û—Ç–≤–µ—Ç –ø—Ä–∏ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç–µ
{
  "status": "ok",
  "service": "CommentsSystem",
  "version": "1.0.0",
  "timestamp": "2024-01-15T10:30:00Z"
}
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —É—Ä–æ–≤–Ω—è–º–∏:

```go
// –ü—Ä–∏–º–µ—Ä –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –∫–æ–¥–µ
log.Info("Starting server", "addr", config.HTTPAddr)
log.Error("Database connection failed", "error", err)
```

### Graceful Shutdown

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Ä–∞–±–æ—Ç—É –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤:

```go
// –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏–≥–Ω–∞–ª–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
c := make(chan os.Signal, 1)
signal.Notify(c, os.Interrupt, syscall.SIGTERM)

<-c
log.Info("Shutting down server...")
```

---

## üîß –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–∏–Ω—Ü–∏–ø—ã Clean Architecture

1. **Dependency Inversion**: –°–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–Ω—ã–π —Å–ª–æ–π
2. **Single Responsibility**: –ö–∞–∂–¥—ã–π —Å–ª–æ–π –∏–º–µ–µ—Ç –æ–¥–Ω—É –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å
3. **Interface Segregation**: –ú–µ–ª–∫–∏–µ, —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
4. **Open/Closed**: –õ–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è–µ–º–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä—ã –º–µ–∂–¥—É —Å–ª–æ—è–º–∏

#### API ‚Üî Domain –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä—ã (`internal/converter/`)
```go
type GraphQLConverter struct{}
func (c *GraphQLConverter) PostToGraphQL(post *model.Post) map[string]interface{}
func (c *GraphQLConverter) PostsToGraphQL(posts []*model.Post) []interface{}

type ValidationConverter struct{}
func (c *ValidationConverter) ValidateAndConvertPostInput(title, content string) (*model.Post, error)
```

#### Domain ‚Üî Storage –∫–æ–Ω–≤–µ—Ä—Ç–µ—Ä—ã (`internal/repository/converter/`)
```go
type PostConverter struct{}
func (c *PostConverter) ToStorage(post *model.Post) *storage_model.PostDB
func (c *PostConverter) FromStorage(postDB *storage_model.PostDB) *model.Post

type CommentConverter struct{}
func (c *CommentConverter) ToStorage(comment *model.Comment) *storage_model.CommentDB
func (c *CommentConverter) FromStorage(commentDB *storage_model.CommentDB) *model.Comment
```

### –ú–æ–¥–µ–ª–∏ –ø–æ —Å–ª–æ—è–º

#### Domain –º–æ–¥–µ–ª–∏ (`internal/model/entities.go`)
```go
type Post struct {
    ID              uuid.UUID `json:"id"`
    Title           string    `json:"title"`
    Content         string    `json:"content"`
    CommentsEnabled bool      `json:"commentsEnabled"`
    CreatedAt       time.Time `json:"createdAt"`
}
```

#### Storage –º–æ–¥–µ–ª–∏ (`internal/repository/model/storage_models.go`)
```go
type PostDB struct {
    ID              string    `db:"id"`
    Title           string    `db:"title"`
    Content         string    `db:"content"`
    CommentsEnabled bool      `db:"comments_enabled"`
    CreatedAt       time.Time `db:"created_at"`
}
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

1. **–¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å**: –õ–µ–≥–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –º–æ–∫-–æ–±—ä–µ–∫—Ç–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–ª–æ—è
2. **–ò–∑–æ–ª—è—Ü–∏—è**: –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ–¥–Ω–æ–º —Å–ª–æ–µ –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –¥—Ä—É–≥–∏–µ
3. **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å**: –ü—Ä–æ—Å—Ç–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö storage –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ –∏–ª–∏ API —Ñ–æ—Ä–º–∞—Ç–æ–≤
4. **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å**: –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
5. **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**: –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä—ã –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ —Ä–∞–∑–Ω—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞—Ö

### Real-time –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

#### WebSocket –ø–æ–¥–ø–∏—Å–∫–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ –æ –Ω–æ–≤—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ Pub/Sub –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
- Graceful handling –æ—Ç–∫–ª—é—á–µ–Ω–∏–π –∫–ª–∏–µ–Ω—Ç–æ–≤

#### Pub/Sub —Å–∏—Å—Ç–µ–º–∞
```go
// –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏—è –æ –Ω–æ–≤–æ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
topicName := fmt.Sprintf("post:%s:comments", postID.String())
s.pubsub.Publish(topicName, createdComment)

// –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–±—ã—Ç–∏—è
subscriber := s.pubsub.Subscribe(topicName, subscriberID)
```

---

## üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã–µ –ø–æ–ª—è
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –∏–µ—Ä–∞—Ä—Ö–∏–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
- –ü–∞–≥–∏–Ω–∞—Ü–∏—è –¥–ª—è –±–æ–ª—å—à–∏—Ö –Ω–∞–±–æ—Ä–æ–≤ –¥–∞–Ω–Ω—ã—Ö

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- Connection pooling –¥–ª—è PostgreSQL
- In-memory Pub/Sub –¥–ª—è real-time —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- Stateless –¥–∏–∑–∞–π–Ω —Å–µ—Ä–≤–∏—Å–∞
- –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–º—É –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é
- –ò–∑–æ–ª—è—Ü–∏—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –æ—Ç –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

#### –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è |
|------------|----------|----------------------|--------------|
| `HTTP_ADDR` | –ê–¥—Ä–µ—Å HTTP —Å–µ—Ä–≤–µ—Ä–∞ | `:8080` | –ù–µ—Ç |
| `STORAGE_TYPE` | –¢–∏–ø —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ (`postgres`, `memory`) | `postgres` | –ù–µ—Ç |
| `DB_DSN` | –°—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL | - | –î–∞ (–¥–ª—è postgres) |

#### GraphQL –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|------------|----------|----------------------|
| `GRAPHQL_INTROSPECTION` | –í–∫–ª—é—á–∏—Ç—å GraphQL introspection | `true` |
| `GRAPHQL_PLAYGROUND` | –í–∫–ª—é—á–∏—Ç—å GraphQL Playground | `true` |
| `GRAPHQL_ENDPOINT` | –ü—É—Ç—å GraphQL endpoint | `/graphql` |
| `PLAYGROUND_TITLE` | –ó–∞–≥–æ–ª–æ–≤–æ–∫ GraphQL Playground | `CommentsSystem API` |

#### –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|------------|----------|----------------------|
| `MAX_PAGE_SIZE` | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã | `100` |
| `DEFAULT_PAGE_SIZE` | –†–∞–∑–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é | `10` |
| `MAX_CONTENT_LENGTH` | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ | `10000` |
| `MAX_TITLE_LENGTH` | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞ | `255` |
| `MAX_COMMENT_LENGTH` | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è | `2000` |
| `CHANNEL_BUFFER_SIZE` | –†–∞–∑–º–µ—Ä –±—É—Ñ–µ—Ä–∞ Pub/Sub –∫–∞–Ω–∞–ª–æ–≤ | `100` |

#### HTTP –∏ Timeout –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|------------|----------|----------------------|
| `READ_TIMEOUT` | –¢–∞–π–º–∞—É—Ç —á—Ç–µ–Ω–∏—è HTTP | `15s` |
| `WRITE_TIMEOUT` | –¢–∞–π–º–∞—É—Ç –∑–∞–ø–∏—Å–∏ HTTP | `15s` |
| `REQUEST_TIMEOUT` | –¢–∞–π–º–∞—É—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ | `30s` |
| `SHUTDOWN_TIMEOUT` | –¢–∞–π–º–∞—É—Ç graceful shutdown | `30s` |
| `KEEP_ALIVE_PING` | –ò–Ω—Ç–µ—Ä–≤–∞–ª ping WebSocket | `30s` |

#### CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|------------|----------|----------------------|
| `CORS_ALLOW_ORIGIN` | –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ CORS origins | `*` |
| `CORS_ALLOW_METHODS` | –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ HTTP –º–µ—Ç–æ–¥—ã | `GET,POST,OPTIONS` |
| `CORS_ALLOW_HEADERS` | –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ | `*` |

#### Rate Limiting –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|------------|----------|----------------------|
| `RATE_LIMIT_ENABLED` | –í–∫–ª—é—á–∏—Ç—å rate limiting | `true` |
| `RATE_LIMIT_REQUESTS_PER_SECOND` | –ó–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É | `100` |
| `RATE_LIMIT_BURST_CAPACITY` | Burst capacity | `200` |
| `COMMENT_RATE_LIMIT_PER_POST` | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∫ –ø–æ—Å—Ç—É | `5 –∑–∞ 10–º–∏–Ω` |
| `COMMENT_RATE_LIMIT_PER_IP` | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ —Å IP | `20 –≤ –º–∏–Ω—É—Ç—É` |

### –¢–∏–ø—ã —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

#### PostgreSQL (`STORAGE_TYPE=postgres`)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: Production-ready —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å persistent –¥–∞–Ω–Ω—ã–º–∏
- **–§–∞–π–ª—ã**: `internal/repository/postgres.go`, `internal/repository/postgres_test.go`
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
  - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ—Å—Ç–∞–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
  - –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–µ CTE –∑–∞–ø—Ä–æ—Å—ã –¥–ª—è –∏–µ—Ä–∞—Ä—Ö–∏–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
  - ACID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∏ foreign key constraints
  - Connection pooling —Å pgxpool
  - –ü–∞–≥–∏–Ω–∞—Ü–∏—è —Å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–º–∏ LIMIT/OFFSET –∑–∞–ø—Ä–æ—Å–∞–º–∏

#### In-Memory (`STORAGE_TYPE=memory`)
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è
- **–§–∞–π–ª—ã**: `internal/repository/memory.go`, `internal/repository/memory_test.go`
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
  - Thread-safe –¥–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ sync.RWMutex
  - –ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ Storage
  - –†–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è –∏–µ—Ä–∞—Ä—Ö–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –≤ –ø–∞–º—è—Ç–∏
  - –ü–∞–≥–∏–Ω–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ –ø–∞–º—è—Ç–∏
  - –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫ –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### –ü—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

#### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
```bash
export HTTP_ADDR=":8080"
export STORAGE_TYPE="postgres"
export DB_DSN="postgres://user:password@localhost:5433/postsdb?sslmode=disable"
export GRAPHQL_PLAYGROUND="true"
export GRAPHQL_INTROSPECTION="true"
export RATE_LIMIT_ENABLED="true"
```

#### Production
```bash
export HTTP_ADDR=":8080"
export STORAGE_TYPE="postgres"
export DB_DSN="postgres://user:password@db:5432/postsdb?sslmode=disable"
export GRAPHQL_PLAYGROUND="false"
export GRAPHQL_INTROSPECTION="false"
export CORS_ALLOW_ORIGIN="https://yourdomain.com"
export RATE_LIMIT_ENABLED="true"
export REQUEST_TIMEOUT="30s"
export SHUTDOWN_TIMEOUT="30s"
```

#### Docker Compose
```yaml
environment:
  - HTTP_ADDR=:8080
  - STORAGE_TYPE=postgres
  - DB_DSN=postgres://user:password@db:5432/postsdb?sslmode=disable
  - GRAPHQL_PLAYGROUND=true
  - MAX_PAGE_SIZE=100
  - RATE_LIMIT_ENABLED=true
```

---

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### Docker Compose (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. **–ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:**
```bash
git clone https://github.com/NarthurN/CommentsSystem.git
cd CommentsSystem
```

2. **–ó–∞–ø—É—Å–∫ —Å PostgreSQL:**
```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker compose up -d

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker compose ps

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker compose logs -f app
```

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã:**
```bash
# Health check
curl http://localhost:8080/health

# GraphQL Playground
open http://localhost:8080/
```

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

1. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:**
```bash
go mod download
```

2. **–ó–∞–ø—É—Å–∫ PostgreSQL:**
```bash
docker compose up -d db
```

3. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
```bash
export DB_DSN="postgres://user:password@localhost:5433/postsdb?sslmode=disable"
export STORAGE_TYPE="postgres"
export HTTP_ADDR=":8080"
export GRAPHQL_PLAYGROUND="true"
```

4. **–ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**
```bash
go run cmd/app/main.go
```

### Production —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

#### Docker –æ–±—Ä–∞–∑
```dockerfile
# –ú–Ω–æ–≥–æ—Å—Ç–∞–¥–∏–π–Ω–∞—è —Å–±–æ—Ä–∫–∞ –¥–ª—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞
FROM golang:1.23-alpine AS builder
WORKDIR /app
COPY go.mod go.sum ./
RUN go mod download
COPY . .
RUN CGO_ENABLED=0 GOOS=linux go build -o comments-system ./cmd/app

FROM alpine:latest
RUN apk --no-cache add ca-certificates
WORKDIR /root/
COPY --from=builder /app/comments-system .
EXPOSE 8080
CMD ["./comments-system"]
```

#### Kubernetes Deployment
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: comments-system
spec:
  replicas: 3
  selector:
    matchLabels:
      app: comments-system
  template:
    metadata:
      labels:
        app: comments-system
    spec:
      containers:
      - name: comments-system
        image: comments-system:latest
        ports:
        - containerPort: 8080
        env:
        - name: DB_DSN
          valueFrom:
            secretKeyRef:
              name: postgres-secret
              key: dsn
        - name: STORAGE_TYPE
          value: "postgres"
        resources:
          requests:
            memory: "64Mi"
            cpu: "250m"
          limits:
            memory: "128Mi"
            cpu: "500m"
```

### –ö–æ–º–∞–Ω–¥—ã Make

```bash
# –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫
make build              # –°–±–æ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
make run               # –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
make docker-build      # –°–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–æ–≤
make docker-up         # –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
make docker-down       # –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
make test              # –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤
make test-unit         # –¢–æ–ª—å–∫–æ unit-—Ç–µ—Å—Ç—ã
make test-integration  # –¢–æ–ª—å–∫–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
make test-coverage     # –¢–µ—Å—Ç—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º

# –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
make deps             # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
make clean            # –û—á–∏—Å—Ç–∫–∞ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤
make lint             # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∫–æ–¥–∞
make format           # –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞

# GraphQL
make generate         # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è GraphQL –∫–æ–¥–∞
make schema           # –í–∞–ª–∏–¥–∞—Ü–∏—è GraphQL —Å—Ö–µ–º—ã

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
make migrate-up       # –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
make migrate-down     # –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–π

# –ü–æ–º–æ—â—å
make help             # –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–æ–º–∞–Ω–¥
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤

| –¢–∏–ø —Ç–µ—Å—Ç–æ–≤ | –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –ü–æ–∫—Ä—ã—Ç–∏–µ |
|------------|--------------|------------|----------|
| **Unit —Ç–µ—Å—Ç—ã** | `internal/service/*_test.go` | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ | 85% |
| **Integration —Ç–µ—Å—Ç—ã** | `internal/repository/*_test.go` | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–µ–∞–ª—å–Ω–æ–π –ë–î | 70% |
| **Comparison —Ç–µ—Å—Ç—ã** | `internal/repository/storage_comparison_test.go` | –°—Ä–∞–≤–Ω–µ–Ω–∏–µ PostgreSQL –∏ Memory | 90% |
| **Performance —Ç–µ—Å—Ç—ã** | `internal/repository/*_bench_test.go` | –ë–µ–Ω—á–º–∞—Ä–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ | - |

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

#### –í—Å–µ —Ç–µ—Å—Ç—ã
```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
make test-coverage
# –∏–ª–∏
go test -cover -race ./...

# –í—Å–µ —Ç–µ—Å—Ç—ã –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
go test -race -parallel 4 ./...
```

#### Unit —Ç–µ—Å—Ç—ã
```bash
# –¢–æ–ª—å–∫–æ unit-—Ç–µ—Å—Ç—ã (–±–µ–∑ –ë–î)
make test-unit
# –∏–ª–∏
go test -short ./internal/service/
```

#### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
```bash
# –¢–µ—Å—Ç—ã —Å —Ä–µ–∞–ª—å–Ω–æ–π PostgreSQL
go test ./internal/repository/ -v

# –¢–µ—Å—Ç—ã —Å —É–∫–∞–∑–∞–Ω–∏–µ–º DSN
DB_DSN="postgres://user:password@localhost:5432/postsdb_test?sslmode=disable" \
go test ./internal/repository/ -v
```

#### –ë–µ–Ω—á–º–∞—Ä–∫–∏
```bash
# –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
go test -bench=. ./internal/repository/

# –ë–µ–Ω—á–º–∞—Ä–∫–∏ GraphQL —Ä–µ–∑–æ–ª–≤–µ—Ä–æ–≤
go test -bench=BenchmarkResolver ./internal/service/
```

### –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

#### Unit —Ç–µ—Å—Ç —Å –º–æ–∫-–æ–±—ä–µ–∫—Ç–∞–º–∏
```go
func TestCreateComment_Validation(t *testing.T) {
    // Setup
    mockStorage := &MockStorage{}
    ps := pubsub.New()
    resolver := NewResolver(mockStorage, ps)

    // Test cases
    tests := []struct {
        name        string
        input       CreateCommentInput
        expectError bool
        errorMsg    string
    }{
        {
            name: "valid comment",
            input: CreateCommentInput{
                PostID:  "123e4567-e89b-12d3-a456-426614174000",
                Content: "Valid comment content",
            },
            expectError: false,
        },
        {
            name: "too long comment",
            input: CreateCommentInput{
                PostID:  "123e4567-e89b-12d3-a456-426614174000",
                Content: strings.Repeat("a", 2001),
            },
            expectError: true,
            errorMsg:    "comment too long",
        },
    }

    // Execute tests
    for _, tt := range tests {
        t.Run(tt.name, func(t *testing.T) {
            _, err := resolver.CreateComment(context.Background(), tt.input)

            if tt.expectError {
                assert.Error(t, err)
                assert.Contains(t, err.Error(), tt.errorMsg)
            } else {
                assert.NoError(t, err)
            }
        })
    }
}
```

#### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç
```go
func TestPostgresStorage_CommentHierarchy(t *testing.T) {
    if testing.Short() {
        t.Skip("Skipping integration test")
    }

    // Setup database
    ctx := context.Background()
    storage, err := repository.NewPostgresStorage(ctx, testDSN)
    require.NoError(t, err)
    defer storage.Close()

    // Create test data
    post := &model.Post{
        Title:   "Test Post",
        Content: "Test content",
    }
    createdPost, err := storage.CreatePost(ctx, post)
    require.NoError(t, err)

    // Create root comment
    rootComment := &model.Comment{
        PostID:  createdPost.ID,
        Content: "Root comment",
    }
    createdRoot, err := storage.CreateComment(ctx, rootComment)
    require.NoError(t, err)

    // Create child comment
    childComment := &model.Comment{
        PostID:   createdPost.ID,
        ParentID: &createdRoot.ID,
        Content:  "Child comment",
    }
    createdChild, err := storage.CreateComment(ctx, childComment)
    require.NoError(t, err)

    // Test hierarchy
    children, err := storage.GetCommentsByParentID(ctx, createdRoot.ID, 10, 0)
    require.NoError(t, err)
    assert.Len(t, children, 1)
    assert.Equal(t, createdChild.ID, children[0].ID)
}
```

#### Storage Comparison —Ç–µ—Å—Ç
```go
func TestStorageComparison_CreateComment(t *testing.T) {
    storages := []struct {
        name    string
        storage repository.Storage
    }{
        {"PostgreSQL", setupPostgresStorage(t)},
        {"Memory", setupMemoryStorage(t)},
    }

    for _, s := range storages {
        t.Run(s.name, func(t *testing.T) {
            // Test identical behavior across storage implementations
            testComment := &model.Comment{
                PostID:  uuid.New(),
                Content: "Test comment",
            }

            created, err := s.storage.CreateComment(context.Background(), testComment)
            assert.NoError(t, err)
            assert.NotEqual(t, uuid.Nil, created.ID)
            assert.Equal(t, testComment.Content, created.Content)
        })
    }
}
```

### Coverage –æ—Ç—á–µ—Ç—ã

#### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTML –æ—Ç—á–µ—Ç–∞
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞ –ø–æ–∫—Ä—ã—Ç–∏—è
go test -coverprofile=coverage.out ./...
go tool cover -html=coverage.out -o coverage.html

# –û—Ç–∫—Ä—ã—Ç–∏–µ –æ—Ç—á–µ—Ç–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
open coverage.html
```

#### CI/CD Coverage
```bash
# –î–ª—è CI/CD pipeline
go test -race -coverprofile=coverage.out -covermode=atomic ./...
```

### –ë–µ–Ω—á–º–∞—Ä–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

#### –ü—Ä–∏–º–µ—Ä –±–µ–Ω—á–º–∞—Ä–∫–∞
```go
func BenchmarkGetCommentsByPostID(b *testing.B) {
    storage := setupTestStorage(b)
    postID := createTestPost(b, storage)

    // Create test comments
    for i := 0; i < 100; i++ {
        createTestComment(b, storage, postID)
    }

    b.ResetTimer()

    for i := 0; i < b.N; i++ {
        _, err := storage.GetCommentsByPostID(context.Background(), postID)
        if err != nil {
            b.Fatal(err)
        }
    }
}
```

### Test Infrastructure

#### Mock Storage
```go
type MockStorage struct {
    posts    map[uuid.UUID]*model.Post
    comments map[uuid.UUID]*model.Comment
    mu       sync.RWMutex
}

func (m *MockStorage) CreatePost(ctx context.Context, post *model.Post) (*model.Post, error) {
    m.mu.Lock()
    defer m.mu.Unlock()

    if post.ID == uuid.Nil {
        post.ID = uuid.New()
    }
    m.posts[post.ID] = post
    return post, nil
}
```

#### –¢–µ—Å—Ç–æ–≤—ã–µ —É—Ç–∏–ª–∏—Ç—ã
```go
func setupTestStorage(t *testing.T) repository.Storage {
    if testing.Short() {
        return repository.NewMemoryStorage()
    }

    storage, err := repository.NewPostgresStorage(context.Background(), testDSN)
    require.NoError(t, err)
    t.Cleanup(func() { storage.Close() })
    return storage
}
```

### –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

#### –¢–µ–∫—É—â–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ
- **–û–±—â–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ**: 10.0%
- **Service layer**: 85%
- **Repository layer**: 70%
- **API layer**: 45%

#### –¶–µ–ª–∏ –ø–æ –ø–æ–∫—Ä—ã—Ç–∏—é
- **Service layer**: 90%+
- **Repository layer**: 85%+
- **API layer**: 70%+
- **–û–±—â–µ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ**: 80%+

---

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ CommentsSystem –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ, –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏ —Å —Å–ª–µ–¥—É—é—â–∏–º–∏ –∫–ª—é—á–µ–≤—ã–º–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è–º–∏:

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞
- **Clean Architecture** —Å —á–µ—Ç–∫–∏–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- **Type-safe GraphQL API** —Å –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –∫–æ–¥–∞
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏** –ø—Ä–æ—Ç–∏–≤ N+1 –ø—Ä–æ–±–ª–µ–º
- **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** —Å —Ç–∏–ø–∏–∑–∞—Ü–∏–µ–π
- **Multi-level rate limiting** –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –∑–ª–æ—É–ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–π

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è
- **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ SQL –∏–Ω–¥–µ–∫—Å—ã** –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
- **Real-time –ø–æ–¥–ø–∏—Å–∫–∏** —á–µ—Ä–µ–∑ WebSocket
- **Graceful shutdown** —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- **Dual storage support** (PostgreSQL + In-Memory)
- **Comprehensive —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** —Å –º–æ–∫-–æ–±—ä–µ–∫—Ç–∞–º–∏

### Production-ready –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
- **Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è** —Å –º–Ω–æ–≥–æ—Å—Ç–∞–¥–∏–π–Ω–æ–π —Å–±–æ—Ä–∫–æ–π
- **Health check** —Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è –ë–î
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–µ timeout'—ã** –∏ –ª–∏–º–∏—Ç—ã
- **CORS –ø–æ–¥–¥–µ—Ä–∂–∫–∞** –¥–ª—è web-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
- **Thread-safe –æ–ø–µ—Ä–∞—Ü–∏–∏** –≤–æ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –¥–ª—è production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏ –º–æ–∂–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å—Å—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—ã—Å–æ–∫–∏—Ö –Ω–∞–≥—Ä—É–∑–æ–∫ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏.
